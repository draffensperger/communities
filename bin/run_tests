#!/usr/bin/env bash

export PATH=$PATH:${HOME}/google-cloud-sdk/bin

gcloud beta emulators datastore start --quiet --project=twitter-fetch --no-store-on-disk &
DATASTORE_PID=$!
sleep 2

$(gcloud beta emulators datastore env-init)
mvn clean test
RESULT=$?

kill -9 $DATASTORE_PID

exit $RESULT
